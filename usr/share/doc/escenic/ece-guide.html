<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
lang="en" xml:lang="en">
<head>
<title>Guide for the /usr/bin/ece Script</title>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2011-10-10 14:56:44 CST"/>
<meta name="author" content="Torstein Krause Johansen"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  {margin-left:auto; margin-right:0px;  text-align:right;}
  .left   {margin-left:0px;  margin-right:auto; text-align:left;}
  .center {margin-left:auto; margin-right:auto; text-align:center;}
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top;  }
  th.right  { text-align:center;  }
  th.left   { text-align:center;   }
  th.center { text-align:center; }
  td.right  { text-align:right;  }
  td.left   { text-align:left;   }
  td.center { text-align:center; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  div.inlinetask {
    padding:10px;
    border:2px solid gray;
    margin:10px;
    background: #ffffcc;
  }
  textarea { overflow-x: auto; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style><style type="text/css">
body {
  font-family: Arial, Helvetica, sans-serif;
  font-size: small;
  #width : 600;
  margin: 70px 70px 0px 50px;
}

h1, h2 {
  color: #e88424;
}

h1 {
  font-size: 150%;
}

h2 {
  font-size: 120%;
  margin-top: 3em;
  margin-bottom: 0em;
}

h3, h4, h5, h6 {
  font-weight: bold;
  margin-top: 2em;
  margin-bottom: 0.2em;
}

h3, h4, h5 {
  font-size: 110%;
}

h6 {
  font-size: 80%;
}

a {
  color: #333;
  font-weight: bold;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

p, dl {
  font-size: 95%;
}

p {
  margin-top: 0em;
  margin-bottom: 0.6em;
}

pre.programlisting {
  margin-top: 0em;
  background-color: #ffddaa;
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  padding-left: 0.5em;
  padding-right: 0.5em;
}

em {
  font-weight: bold;
  font-style: normal;
}

em.replaceable {
  font-weight: normal;
  font-style: italic;
}

div.note {
  background-color: #ffddaa;
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  padding-left: 0.5em;
  padding-right: 0.5em;
}
</style>

<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>

</head>
<body>

<div id="preamble">
<svg
        id="vizrt-logo"
        version="1.1"
        width="138"
        height="84"
        > 
  <g
          id="g12"
          transform="matrix(1.25,0,0,-1.25,-451.34003,425.24315)"> 
    <g
            id="g14"
            transform="matrix(0.0246257,0,0,0.02458666,313.76213,231.21317)"> 
      <path
              d="m 3060.56,3437.2 -209.9,-593.4 -207.05,593.4 -215.82,0 326.08,-866.38 184.92,0 332.24,866.38 -210.47,0"
              style="fill:#f57615;fill-opacity:1;fill-rule:evenodd;stroke:none"
              id="path16"/> 
      <path
              d="m 3473.3,2569.82 193.547,0 0,866.531 -193.547,0 0,-866.531 z"
              style="fill:#f57615;fill-opacity:1;fill-rule:evenodd;stroke:none"
              id="path18"/> 
      <path
              d="m 3916.16,3436.36 -0.14,-177.24 364.23,0 -372.91,-554.74 0,-133.56 616.08,0 0,175.25 -374.66,0 366.68,550.78 0,139.51 -599.28,0"
              style="fill:#f57615;fill-opacity:1;fill-rule:evenodd;stroke:none"
              id="path20"/> 
      <path
              d="m 4961.8,3436.66 c -56.15,0 -99.9,-9.02 -144.01,-53.04 -42.13,-42.13 -63.55,-93.63 -63.55,-153.7 l 0,-658.85 193.26,0 0,629.18 c 0,16.39 5.76,30.04 17.53,41.82 9.79,9.87 32.16,17.44 52.18,17.44 l 161.49,0 0,177.15 -216.9,0"
              style="fill:#f57615;fill-opacity:1;fill-rule:evenodd;stroke:none"
              id="path22"/> 
      <path
              d="m 5367.91,3699.54 0,-915.91 c 0,-58.68 20.75,-109.43 62.13,-150.8 43.31,-43.47 85.57,-62.01 141.03,-62.01 l 212.69,0 0,174.7 -158.78,0 c -15.96,0 -28.96,5.5 -40.72,16.87 -11.19,11.53 -16.76,24.5 -16.76,40.65 l 0,456.42 216.26,0 0,176.39 -216.26,0 0,263.69 -199.59,0"
              style="fill:#f57615;fill-opacity:1;fill-rule:evenodd;stroke:none"
              id="path24"/> 
      <path
              d="m 1921.16,3066.86 c -0.39,-514.15 173.24,-988.49 465.56,-1367.51 l 69.26,204.63 c -205.49,300.61 -333.44,658.06 -355.3,1043.68 l -179.52,119.2"
              style="fill:#f57615;fill-opacity:1;fill-rule:evenodd;stroke:none"
              id="path26"/> 
      <path
              d="m 6404.28,3065.28 c 0.49,513.97 -173.17,988.55 -465.37,1367.26 l -69.46,-204.34 c 205.52,-300.7 333.61,-658.34 355.24,-1043.68 l 179.59,-119.24"
              style="fill:#f57615;fill-opacity:1;fill-rule:evenodd;stroke:none"
              id="path28"/> 
 
    </g> 
  </g> 
</svg>

</div>

<div id="content">
<h1 class="title">Guide for the /usr/bin/ece Script</h1>


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1 TAB completion </a>
<ul>
<li><a href="#sec-1-1">1.1 Completing ece commands </a></li>
<li><a href="#sec-1-2">1.2 Completing types of servers the ece scripts can operate on </a></li>
<li><a href="#sec-1-3">1.3 Completing the publication resources available </a></li>
</ul>
</li>
<li><a href="#sec-2">2 Getting an overview of all available options </a></li>
<li><a href="#sec-3">3 Tailing log files </a>
<ul>
<li><a href="#sec-3-1">3.1 Getting an overview of the log files </a></li>
<li><a href="#sec-3-2">3.2 Commands for tailing the log files </a></li>
<li><a href="#sec-3-3">3.3 Piping the log files to another command </a></li>
</ul>
</li>
<li><a href="#sec-4">4 Assembling a new EAR </a></li>
<li><a href="#sec-5">5 Installation </a>
<ul>
<li><a href="#sec-5-1">5.1 Overview of File Paths Used by the ece script </a></li>
</ul>
</li>
<li><a href="#sec-6">6 Running the ece script </a>
<ul>
<li><a href="#sec-6-1">6.1 You must run it as a non-privileged user </a></li>
<li><a href="#sec-6-2">6.2 Specifying instance </a>
<ul>
<li><a href="#sec-6-2-1">6.2.1 Specifying the instance </a></li>
<li><a href="#sec-6-2-2">6.2.2 Using the default instance </a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> TAB completion </h2>
<div class="outline-text-2" id="text-1">

<p>The ece script offers TAB completion, given that your version of BASH
supports this and that you have enabled it (some distributions hasn't
turned on BASH completion per default).
</p>

</div>

<div id="outline-container-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> Completing ece commands </h3>
<div class="outline-text-3" id="text-1-1">

<p>You will find yourself using this regularly, both for speed, but also
to remember all the different options and their correct wording:
</p>


<pre class="src src-sh">$ ece TAB TAB
applog      deploy      log         start       threaddump  
assemble    help        outlog      status      update      
clean       kill        restart     stop        versions 
</pre>

<p>
The commands are all described in detail in "ece help"
</p>
</div>

</div>

<div id="outline-container-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> Completing types of servers the ece scripts can operate on </h3>
<div class="outline-text-3" id="text-1-2">




<pre class="src src-sh">$ ece -t TAB TAB
analysis  engine    rmi-hub   search 
</pre>


</div>

</div>

<div id="outline-container-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> Completing the publication resources available </h3>
<div class="outline-text-3" id="text-1-3">

<p>The ece script can update the publication resources for a given
publication.
</p>
<p>
To help selecting the correct publication resource, you can make ece
list and complete the available resource names:
</p>


<pre class="src src-sh">$ ece -p mypub -r TAB TAB
content-type   image-version  layout-group   
feature        layout         menu
</pre>

</div>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Getting an overview of all available options </h2>
<div class="outline-text-2" id="text-2">




<pre class="src src-sh">$ ece help
Usage: /home/torstein/bin/ece [-t &lt;type&gt;] [-i &lt;instance&gt;] &lt;command&gt;

DESCRIPTION
 -t --type &lt;type&gt;
      The following types are available:
      engine  -  The Escenic Content Engine, this is the default
                 and is the assumed type if none is specified.
      search  -  A standalone search indexer and solr instance
      rmi-hub -  The RMI hub responsible for the internal 
                 communication between the ECE instances.
      analysis - The Escenic Analysis Engine also knows as <span style="color: #8b2252;">'Stats'</span>

 -i --instance &lt;instance&gt;
      The type instance, such as editor1, web1 or search1

 -p --publication &lt;publication&gt;
      Needed only for updating publication resources

 -r --resource &lt;resource&gt;
      Used for updating publication resources.
      Must be one of: content-type, feature, layout, layout-group
                      image-version, menu

 -v --verbose
      Prints out debug statements, useful for debugging.

The following commands are available:
   applog     the type<span style="color: #8b2252;">'s app server log</span>
<span style="color: #8b2252;">   assemble   runs the Assembly Tool *)</span>
<span style="color: #8b2252;">   clean      removes temporary files created by /home/torstein/bin/ece *)</span>
<span style="color: #8b2252;">   deploy     deploys the assembled EAR *)</span>
<span style="color: #8b2252;">   help       prints this help screen</span>
<span style="color: #8b2252;">   kill       uses force to stop the type</span>
<span style="color: #8b2252;">   log        the type'</span>s Log4J log
   outlog     the [ece#engine] script log (system out log)
   restart    restarts the type
   start      starts the type
   status     checks if the type is running
   stop       stops the type
   threaddump write a thread dump to standard out (system out log)
   update     update publication resources
   versions   lists the ECE component versions

*) only applicable if type is <span style="color: #8b2252;">'engine'</span>
</pre>


</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Tailing log files </h2>
<div class="outline-text-2" id="text-3">

<p>The script has a number of options to let you keep track of what's
going on on your system.
</p>

</div>

<div id="outline-container-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> Getting an overview of the log files </h3>
<div class="outline-text-3" id="text-3-1">

<p>The ece script will be more than happy to tell you about the log files
on your system that are of interest to your instance:
</p>


<pre class="src src-sh">$ ece -i dev1 loglist
[ece#engine-dev1] System out log: /var/log/escenic/engine-dev1.out
[ece#engine-dev1] App server log: /opt/tomcat-dev1/logs/localhost.2011-09-20.log
[ece#engine-dev1] log4j log: /var/log/escenic/messages
</pre>


</div>

</div>

<div id="outline-container-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> Commands for tailing the log files </h3>
<div class="outline-text-3" id="text-3-2">

<p>There are three different logs, which ece will let you tail. When
tailing the log file, ece will also first print out where the file is
located on the file system so you can open it later for further
inspection. 
</p>



<pre class="src src-sh">$ ece -i dev1 outlog
[ece#engine-dev1] Tailing the system out log /var/log/escenic/engine-dev1.out
</pre>


<p>
The available log file commands are:
</p><dl>
<dt>outlog</dt><dd>the system out log
</dd>
<dt>applog</dt><dd>the app server log 
</dd>
<dt>log</dt><dd>the log4j log
</dd>
</dl>


</div>

</div>

<div id="outline-container-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> Piping the log files to another command </h3>
<div class="outline-text-3" id="text-3-3">

<p>If you wish to pass the log files onto another pipe, for instance to
grep all the log files for a certain exception or error message, you
will find the -q parameter useful:
</p>


<pre class="src src-sh">$ ece -i dev1 -q loglist | xargs grep IllegalArgumentException
</pre>


<p>
This approach is also useful if you wish to tail all the log files at
once: 
</p>


<pre class="src src-sh">$ ece -i dev1 -q loglist | xargs tail -f
</pre>


</div>
</div>

</div>

<div id="outline-container-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Assembling a new EAR </h2>
<div class="outline-text-2" id="text-4">

<p>The script will quite happily assemble your EAR file. Please note that
you need to run 
</p>


<pre class="src src-sh">$ ece -i clean assemble
</pre>

<p>
whenever you've upgraded either ECE or one of its plugins. The script
will try to take care of you though and warn you of such duplication:
</p>


<pre class="src src-sh">[ece#engine] Multiple versions of ECE and/or 3rd party libraries found.
[ece#engine] Remember, you need to run <span style="color: #8b2252;">'ece clean assemble'</span> when
[ece#engine] upgrading either ECE or one of the plugins.
[ece#engine] I will now clean it up for you and re-run the assembly.
[ece#engine] Cleaning up generated files<span style="color: #a020f0;"> in</span> /opt/escenic/assemblytool ...
[ece#engine] Assembling your EAR file ...
</pre>


<p>
If you're just re-running the assembly after just adding a new plugin
or want to re-build your publications after template changes, you can
omit the clean command and just run:
</p>


<pre class="src src-sh">$ ece assembly
</pre>


<p>
The EAR produced is now ready to be deployed with
</p>


<pre class="src src-sh">$ ece [-i &lt;instance&gt;] deploy
</pre>

</div>

</div>

<div id="outline-container-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Installation </h2>
<div class="outline-text-2" id="text-5">

<p>The ece script and ece.conf may be used on any Unix like system that
has a fairly recent version of BASH installed.
</p>

</div>

<div id="outline-container-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> Overview of File Paths Used by the ece script </h3>
<div class="outline-text-3" id="text-5-1">

<p>These are recommended files and locations for using the ece script:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col class="left" /><col class="left" />
</colgroup>
<thead>
<tr><th scope="col" class="left">Path</th><th scope="col" class="left">Explanation</th></tr>
</thead>
<tbody>
<tr><td class="left">/usr/bin/ece</td><td class="left">The script itself</td></tr>
<tr><td class="left">/etc/escenic/ece.conf</td><td class="left">The main configuration file</td></tr>
<tr><td class="left">/etc/escenic/ece-&lt;instance&gt;.conf</td><td class="left">Instance specific settings</td></tr>
<tr><td class="left">/var/cache/escenic</td><td class="left">Directory of assembled EAR files</td></tr>
<tr><td class="left">/tmp</td><td class="left">Directory for temporary files</td></tr>
</tbody>
</table>


<p>
As you can see in ece.conf, there are a number of default locations
dealing with log files, pid files, crash files as well as application
server files. The defaults all follow the File Hierarchy Standard, but
you may of course change these to your liking.
</p>
<p>
If you wish to put the .conf files in other places, you may like to know
that the ece script has preset list of locations where it looks for
the .conf files mentioned above, namely:
</p>
<ul>
<li>current working directory
</li>
<li>/etc/escenic/&lt;type&gt;/instance/&lt;instance name&gt;
</li>
<li>/etc/escenic/&lt;type&gt;/host/&lt;hostname&gt;
</li>
<li>/etc/escenic/&lt;type&gt;/common
</li>
<li>/etc/escenic/&lt;type&gt;
</li>
<li><i>etc/escenic - &lt;current working direcotry&gt;</i>../etc
</li>
</ul>


<p>
You may override this list of locations by setting the
this environment variable in your .bashrc or similar:
</p>


<pre class="src src-sh">ECE_CONF_LOCATIONS 
</pre>


<p>
The reason for having so many options is because various Escenic
consultants, partners and customers have requested these locations to
fit their systems. As you can see, fitting everyone's fancy adds up
over time :-)
</p>
</div>
</div>

</div>

<div id="outline-container-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> Running the ece script </h2>
<div class="outline-text-2" id="text-6">


</div>

<div id="outline-container-6-1" class="outline-3">
<h3 id="sec-6-1"><span class="section-number-3">6.1</span> You must run it as a non-privileged user </h3>
<div class="outline-text-3" id="text-6-1">

<p>You must be normal user to run the ece script, otherwise it will
complain:
</p>


<pre class="src src-sh">[ece#engine] Sorry, you cannot be root when running ece
[ece#engine] The root user can only use /etc/init.d/ece
</pre>


<p>
As it mentions, the root user may use the init.d script and the
accompanying /etc/default/ece to command the different ECE, EAE and
RMI hub instances on your system.
</p></div>

</div>

<div id="outline-container-6-2" class="outline-3">
<h3 id="sec-6-2"><span class="section-number-3">6.2</span> Specifying instance </h3>
<div class="outline-text-3" id="text-6-2">



</div>

<div id="outline-container-6-2-1" class="outline-4">
<h4 id="sec-6-2-1"><span class="section-number-4">6.2.1</span> Specifying the instance </h4>
<div class="outline-text-4" id="text-6-2-1">

<p>The script is made for being easy to use with multiple instances on
the same host. You specify the instance you want to operate on using the
-i parameter. E.g. to assemble and deploy the editor1 instance, you'd
do:
</p>


<pre class="src src-sh">$ ece -i editor1 assemble deploy restart
</pre>


</div>

</div>

<div id="outline-container-6-2-2" class="outline-4">
<h4 id="sec-6-2-2"><span class="section-number-4">6.2.2</span> Using the default instance </h4>
<div class="outline-text-4" id="text-6-2-2">

<p>However, on development systems and perhaps even test systems, you
probably want to just use one instance on your host, though, and this
is where the "default" instance comes in.
</p>
<p>
To use the default instance, you must only have one instance installed
on your system. More specifically, there must no instance specific
configuration files in
</p>


<pre class="src src-sh">/etc/escenic/engine/instance
</pre>

<p>
and that ece.conf, typically located in:
</p>


<pre class="src src-sh">/etc/escenic/ece.conf
</pre>

<p>
must contain all the settings required to run the instance.
</p>
<p>
If you've ticked all these boxes, you can issue all ece commands
without the -i parameter.
</p></div>
</div>
</div>
</div>
</div>

<div id="postamble">
<hr/>
<p class="author">
  Author: Torstein Krause Johansen (<a href="mailto:tkj@vizrt.com">tkj@vizrt.com</a>)
  Date: 2011-10-10 14:56:44 CST
</p>
</div>
</body>
</html>
